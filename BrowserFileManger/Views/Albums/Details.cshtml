@model BrowserFileManger.ViewModels.AlbumDetailsViewModel

@{
    ViewData["Title"] = Model.Album.Name;
}

<div class="entity-page">
    <div class="entity-header">
        <div class="header-content">
            <h1 class="entity-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
                @Model.Album.Name
            </h1>
            <span class="entity-count">@Model.Tracks.Count track@(Model.Tracks.Count != 1 ? "s" : "")</span>
        </div>
        <a asp-action="Index" class="btn btn-secondary">Back to Albums</a>
    </div>

    @if (!Model.Tracks.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 18V5l12-2v13"/>
                    <circle cx="6" cy="18" r="3"/>
                    <circle cx="18" cy="16" r="3"/>
                </svg>
            </div>
            <h3 class="empty-title">No tracks on this album</h3>
            <p class="empty-subtitle">Assign tracks to this album to start listening</p>
        </div>
    }
    else
    {
        <div class="track-grid" data-autoplay-next="true">
            @foreach (var track in Model.Tracks)
            {
                <div class="track-card">
                    <div class="track-artwork">
                        @if (!string.IsNullOrEmpty(track.AlbumArtBase64))
                        {
                            <img src="@track.AlbumArtBase64" alt="Album Art for @track.Title" class="artwork-image" />
                        }
                        else if (!string.IsNullOrEmpty(Model.Album.AlbumArtBase64))
                        {
                            <img src="@Model.Album.AlbumArtBase64" alt="Album Art for @Model.Album.Name" class="artwork-image" />
                        }
                        else
                        {
                            <div class="artwork-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </div>
                        }
                    </div>
                    <div class="track-info">
                        <h4 class="track-title">@(string.IsNullOrEmpty(track.Title) ? track.FileName : track.Title)</h4>
                        @if (track.TrackArtists.Any())
                        {
                            <p class="track-artist">@string.Join(", ", track.TrackArtists.Select(ta => ta.Artist?.Name))</p>
                        }
                        else
                        {
                            <p class="track-artist track-artist-unknown">Unknown Artist</p>
                        }
                        <p class="track-album">@(track.TrackNumber > 0 ? $"Track {track.TrackNumber}" : "Track")</p>
                    </div>
                    <div class="track-player">
                        @{
                            string mimeType = null;
                            if (track.FileName.EndsWith(".wav", StringComparison.OrdinalIgnoreCase))
                            {
                                mimeType = "audio/wav";
                            }
                            else if (track.FileName.EndsWith(".mp3", StringComparison.OrdinalIgnoreCase))
                            {
                                mimeType = "audio/mpeg";
                            }
                        }
                        @if (mimeType != null)
                        {
                            <audio controls class="audio-player">
                                <source src="~/uploads/@track.FileName" type="@mimeType"/>
                                Your browser does not support the audio element.
                            </audio>
                        }
                        else
                        {
                            <div class="unsupported-format">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                Unsupported format
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>
